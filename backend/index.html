<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Chat app</title>
    </head>
    <body>
        <input id="name" />
        <button onClick="connect()">Connect</button>
        <input id="message" />
        <button onClick="sendMessage()">Send Message</button>
        <div id="messages"></div>
    </body>

    <script>
        let socket;

        const connect = () => {
            socket = new WebSocket("ws://localhost:8080");

            socket.addEventListener("open", (event) => {
                console.log("Connected to WSS");
                socket.send(
                    JSON.stringify({
                        name: document.getElementById("name").value,
                    }),
                );
            });

            socket.addEventListener("message", (event) => {
                let jsonData = JSON.parse(event.data);
                jsonData.message
                    ? addMessageToPage(`${jsonData.name}: ${jsonData.message}`)
                    : addMessageToPage(`${jsonData.announcement}`);
            });
        };

        const sendMessage = () => {
            let message = document.getElementById("message").value;
            socket.send(JSON.stringify({ message }));
            addMessageToPage(`Me: ${message}`);
        };

        const addMessageToPage = (message) => {
            let textMessage = document.createElement("p");
            textMessage.appendChild(document.createTextNode(message));
            document.getElementById("messages").appendChild(textMessage);
        };
    </script>
</html>
